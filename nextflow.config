// Nextflow configuration for maximum performance on local server
// Chromosome 1 Trio Analysis - MCDB 4520 Project

// Process execution settings
process {
    // Maximum resource allocation
    cpus = 32
    memory = '180 GB'
    
    // Enable detailed time tracking for all processes
    time = '24h'
    
    // Error handling
    errorStrategy = 'retry'
    maxRetries = 2
    maxErrors = '-1'
    
    // Resource requirements per process type
    withLabel: 'wf_common' {
        cpus = 4
        memory = '16 GB'
    }
    
    withLabel: 'wf_alignment' {
        cpus = 32
        memory = '64 GB'
    }
    
    withLabel: 'wf_snp' {
        cpus = 32
        memory = '64 GB'
    }
    
    withLabel: 'wf_sv' {
        cpus = 32
        memory = '64 GB'
    }
    
    withLabel: 'wf_str' {
        cpus = 16
        memory = '32 GB'
    }
}

// Executor configuration
executor {
    name = 'local'
    cpus = 32
    memory = '180 GB'
    queueSize = 100
}

// Trace and timeline reports for performance monitoring
trace {
    enabled = true
    file = 'trace.txt'
    fields = 'task_id,hash,native_id,process,tag,name,status,exit,module,container,cpus,time,disk,memory,attempt,submit,start,complete,duration,realtime,queue,%cpu,%mem,rss,vmem,peak_rss,peak_vmem,rchar,wchar,syscr,syscw,read_bytes,write_bytes'
}

timeline {
    enabled = true
    file = 'timeline.html'
}

report {
    enabled = true
    file = 'report.html'
}

dag {
    enabled = true
    file = 'dag.html'
}

// Docker/Singularity settings
// Singularity/Apptainer support for container execution
// Note: Apptainer and Singularity are essentially the same (Singularity was renamed to Apptainer)
// Nextflow treats them as separate engines, so we configure them via profiles
docker {
    enabled = false
}

singularity {
    enabled = false
    autoMounts = true
    cacheDir = "$HOME/.nextflow/singularity"
}

apptainer {
    enabled = false
    autoMounts = true
    cacheDir = "$HOME/.apptainer/cache"
}

profiles {
    singularity {
        docker.enabled = false
        singularity.enabled = true
        singularity.autoMounts = true
        singularity.cacheDir = "$HOME/.nextflow/singularity"
        apptainer.enabled = false
    }
    
    apptainer {
        docker.enabled = false
        apptainer.enabled = true
        apptainer.autoMounts = true
        apptainer.cacheDir = "$HOME/.apptainer/cache"
        singularity.enabled = false
    }
}

// Workflow settings
// Note: max_cpus, max_memory, max_time are managed by the bash wrapper script
// not by the Nextflow workflow itself

// Enable conda if needed
conda {
    enabled = false
}
